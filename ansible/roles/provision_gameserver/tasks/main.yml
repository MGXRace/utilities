- name: Create wsw user
  user: name="{{ wswuser }}"
        password="{{ wswpass }}"
        home="{{ homedir }}"
        shell=/bin/bash
        state=present

- name: Add authorized ssh keys for user
  authorized_key: user="{{ wswuser }}"
                  key="{{ lookup('file', 'example_key.pub') }}"

- name: Installing supervisor
  apt: pkg=supervisor
       state=present
  notify: restart supervisor

- name: Configuring supervisor
  template: src="racesow.conf.j2"
            dest="/etc/supervisor/conf.d/10.racesow.conf"
  notify: restart supervisor

- name: Configuring sudo
  template: src="99_warsow.j2"
            dest="/etc/sudoers.d/99_warsow"
            owner=root
            group=root
            mode=0440

- name: Installing s3cmd
  apt: pkg=s3cmd
       state=present

- name: Installing gameserver
  sudo_user: "{{ wswuser }}"
  unarchive: src="warsow_14_unified.tar.gz"
             dest="{{ homedir }}/"